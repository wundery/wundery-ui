machine:
  node:
    version: stable
  pre:
    - pip install awscli

dependencies:
  override:
    - npm install -g gulp
    - npm install

test:
  override:
    - echo "No Tests :-)"

deployment:
  staging:
    branch: staging
    commands:
      - gulp build --version latest
      - aws s3 sync build $AWS_S3_BUCKET_STAGING --acl public-read --cache-control "public, max-age=0"

  production:
    tag: /v[0-9]+(\.[0-9]+)*/
    commands:
      - TAG=$(git describe --tags `git rev-list --tags --max-count=1`)
      - gulp build --version $TAG
      - aws s3 sync build $AWS_S3_BUCKET_PRODUCTION --acl public-read --cache-control "public, max-age=31536000"
